<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ìš©ì–´ í•™ìŠµ ì‹œìŠ¤í…œ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        margin: 0;
        padding: 16px;
        background: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 16px 20px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      }
      h1 {
        margin-top: 0;
      }
      input,
      button,
      textarea {
        font: inherit;
      }
      .field {
        margin-bottom: 8px;
      }
      .field label {
        display: block;
        font-size: 0.9rem;
        margin-bottom: 4px;
      }
      .field input,
      .field textarea {
        width: 100%;
        padding: 6px 8px;
        border-radius: 4px;
        border: 1px solid #ccc;
        box-sizing: border-box;
      }
      .row {
        display: flex;
        gap: 16px;
        margin-bottom: 16px;
        flex-wrap: wrap;
      }
      .card {
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 8px 10px;
        margin-bottom: 8px;
        background: #fafafa;
      }
      .term-ko {
        font-weight: 600;
      }
      .term-en {
        color: #555;
        font-size: 0.95rem;
      }
      .small {
        font-size: 0.8rem;
        color: #777;
      }
      .error {
        color: #c00;
        margin-bottom: 8px;
        font-size: 0.9rem;
      }
      .success {
        color: #007700;
        margin-bottom: 8px;
        font-size: 0.9rem;
      }
      .btn {
        padding: 6px 12px;
        border-radius: 4px;
        border: 1px solid #007bff;
        background: #007bff;
        color: white;
        cursor: pointer;
      }
      .btn.secondary {
        border-color: #ccc;
        background: #eee;
        color: #333;
      }
      .btn:disabled {
        opacity: 0.6;
        cursor: default;
      }
      .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="container">
        <div class="top-bar">
          <h1>ìš©ì–´ í•™ìŠµ ì‹œìŠ¤í…œ</h1>
          <div v-if="currentUser">
            <span class="small">{{ currentUser.username }} ë‹˜</span>
            <button class="btn secondary" @click="logout">ë¡œê·¸ì•„ì›ƒ</button>
          </div>
        </div>

        <!-- ì—ëŸ¬ / ì„±ê³µ ë©”ì‹œì§€ -->
        <div v-if="errorMessage" class="error">{{ errorMessage }}</div>
        <div v-if="successMessage" class="success">{{ successMessage }}</div>

        <!-- ë¡œê·¸ì¸ ì•ˆ ëœ ìƒíƒœ -->
        <div v-if="!currentUser">
          <div class="row">
            <!-- ë¡œê·¸ì¸ í¼ -->
            <div style="flex: 1 1 260px">
              <h2>ë¡œê·¸ì¸</h2>
              <form @submit.prevent="login">
                <div class="field">
                  <label>ì•„ì´ë””</label>
                  <input v-model="loginForm.username" autocomplete="username" />
                </div>
                <div class="field">
                  <label>ë¹„ë°€ë²ˆí˜¸</label>
                  <input
                    type="password"
                    v-model="loginForm.password"
                    autocomplete="current-password"
                  />
                </div>
                <button class="btn" type="submit" :disabled="loading">
                  ë¡œê·¸ì¸
                </button>
              </form>
            </div>

            <!-- íšŒì›ê°€ì… í¼ -->
            <div style="flex: 1 1 260px">
              <h2>íšŒì›ê°€ì…</h2>
              <form @submit.prevent="signup">
                <div class="field">
                  <label>ì•„ì´ë””</label>
                  <input
                    v-model="signupForm.username"
                    autocomplete="username"
                  />
                </div>
                <div class="field">
                  <label>ë¹„ë°€ë²ˆí˜¸</label>
                  <input
                    type="password"
                    v-model="signupForm.password"
                    autocomplete="new-password"
                  />
                </div>
                <button class="btn secondary" type="submit" :disabled="loading">
                  íšŒì›ê°€ì…
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- ë¡œê·¸ì¸ ëœ ìƒíƒœ -->
        <div v-else>
          <!-- ğŸ”¹ í€´ì¦ˆ ì˜ì—­ -->
          <h2 style="margin-top: 24px">í€´ì¦ˆ</h2>
          <div class="field">
            <label>í€´ì¦ˆ ëª¨ë“œ</label>
            <select v-model="quiz.mode">
              <option value="ko-en">í•œêµ­ì–´ â†’ ì˜ì–´</option>
              <option value="en-ko">ì˜ì–´ â†’ í•œêµ­ì–´</option>
            </select>
          </div>
          <button class="btn secondary" @click="loadQuiz" :disabled="loading">
            ì˜¤ëŠ˜ ë³µìŠµ ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸°
          </button>
          <p class="small" v-if="quiz.totalDue !== null">
            ì˜¤ëŠ˜ ë³µìŠµ ëŒ€ìƒ: {{ quiz.totalDue }}ê°œ / í˜„ì¬ ì„¸ì…˜: {{
            quiz.questions.length }}ê°œ
          </p>

          <div v-if="quiz.questions.length > 0">
            <div class="card" style="margin-top: 8px">
              <div class="small">
                ë¬¸ì œ {{ quiz.currentIndex + 1 }} / {{ quiz.questions.length }}
              </div>
              <div style="margin-top: 4px; margin-bottom: 8px">
                <span v-if="quiz.mode === 'ko-en'">
                  <strong>Q.</strong> ì•„ë˜ í•œêµ­ì–´ ìš©ì–´ì˜ ì˜ì–´ í‘œê¸°ë¥¼
                  ì…ë ¥í•˜ì„¸ìš”.<br />
                  <strong>{{ currentQuestion.ko }}</strong>
                </span>
                <span v-else>
                  <strong>Q.</strong> ì•„ë˜ ì˜ì–´ ìš©ì–´ì˜ í•œêµ­ì–´ ìš©ì–´ë¥¼
                  ì…ë ¥í•˜ì„¸ìš”.<br />
                  <strong>{{ currentQuestion.en }}</strong>
                </span>
              </div>

              <div class="field">
                <label>ë‚´ ë‹µ</label>
                <input v-model="quiz.userAnswer" @keyup.enter="submitAnswer" />
              </div>

              <button class="btn" @click="submitAnswer" :disabled="loading">
                ì •ë‹µ ì œì¶œ
              </button>

              <div v-if="quiz.result !== null" style="margin-top: 8px">
                <div v-if="quiz.result.correct" class="success">
                  ì •ë‹µì…ë‹ˆë‹¤! âœ… (ë‹¤ìŒ ë³µìŠµì¼: {{ quiz.result.nextReviewAt }})
                </div>
                <div v-else class="error">
                  ì˜¤ë‹µì…ë‹ˆë‹¤ âŒ ì •ë‹µ: {{ quiz.result.correctAnswer }}<br />
                  (ë‹¤ìŒ ë³µìŠµì¼: {{ quiz.result.nextReviewAt }})
                </div>

                <!-- ğŸ”¹ ì •ë‹µ í™•ì¸ í›„ ì •ì˜ ë³´ì—¬ì£¼ê¸° -->
                <div
                  v-if="quiz.result.definitionKo || quiz.result.definitionEn"
                  class="small"
                  style="margin-top: 8px"
                >
                  <div v-if="quiz.result.definitionKo">
                    ì •ì˜(í•œ): {{ quiz.result.definitionKo }}
                  </div>
                  <div v-if="quiz.result.definitionEn">
                    ì •ì˜(ì˜): {{ quiz.result.definitionEn }}
                  </div>
                </div>

                <button
                  class="btn secondary"
                  style="margin-top: 8px"
                  @click="nextQuestion"
                >
                  ë‹¤ìŒ ë¬¸ì œ
                </button>
              </div>
            </div>
          </div>
          <p v-else class="small">
            ì•„ì§ í€´ì¦ˆ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤. "ì˜¤ëŠ˜ ë³µìŠµ ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸°"ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”.
          </p>

          <h2>ë‚´ ìš©ì–´ ëª©ë¡</h2>
          <button class="btn secondary" @click="loadTerms" :disabled="loading">
            ìƒˆë¡œê³ ì¹¨
          </button>
          <p v-if="terms.length === 0" class="small">
            ë“±ë¡ëœ ìš©ì–´ê°€ ì—†ìŠµë‹ˆë‹¤. ì•„ë˜ì—ì„œ ìƒˆë¡œ ì¶”ê°€í•´ë³´ì„¸ìš”.
          </p>
          <div v-else>
            <div v-for="term in terms" :key="term.id" class="card">
              <div class="term-ko">{{ term.ko }}</div>
              <div class="term-en">{{ term.en }}</div>
              <div v-if="term.definitionKo" class="small">
                ì •ì˜(í•œ): {{ term.definitionKo }}
              </div>
              <div v-if="term.definitionEn" class="small">
                ì •ì˜(ì˜): {{ term.definitionEn }}
              </div>
              <div v-if="term.tags && term.tags.length" class="small">
                íƒœê·¸: {{ term.tags.join(', ') }}
              </div>
            </div>
          </div>

          <h2 style="margin-top: 24px">ìƒˆ ìš©ì–´ ì¶”ê°€</h2>
          <form @submit.prevent="addTerm">
            <div class="field">
              <label>í•œêµ­ì–´ ìš©ì–´ (í•„ìˆ˜)</label>
              <input v-model="newTerm.ko" />
            </div>
            <div class="field">
              <label>ì˜ì–´ ìš©ì–´ (í•„ìˆ˜)</label>
              <input v-model="newTerm.en" />
            </div>
            <div class="field">
              <label>ì •ì˜ (í•œê¸€)</label>
              <textarea rows="2" v-model="newTerm.definitionKo"></textarea>
            </div>
            <div class="field">
              <label>ì •ì˜ (ì˜ë¬¸)</label>
              <textarea rows="2" v-model="newTerm.definitionEn"></textarea>
            </div>
            <div class="field">
              <label>íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
              <input
                v-model="newTerm.tagsText"
                placeholder="ì˜ˆ: payment, subscription"
              />
            </div>
            <button class="btn" type="submit" :disabled="loading">ì¶”ê°€</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <!-- ì•± ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="./app.js"></script>
  </body>
</html>
