<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Term Trainer - ì–´íœ˜ í•™ìŠµ ë„êµ¬</title>

    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="./style.css" />

    <style>
      /* Bootstrap 5 ì˜¤ë²„ë¼ì´ë“œ */
      .navbar-brand {
        font-weight: 700;
        font-size: 1.5rem;
        letter-spacing: -0.02em;
      }

      .btn-primary {
        background-color: #4f46e5;
        border-color: #4f46e5;
      }

      .btn-primary:hover {
        background-color: #4338ca;
        border-color: #4338ca;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <!-- í—¤ë” -->
      <nav
        class="navbar navbar-expand-lg navbar-light bg-light mb-4 border-bottom"
      >
        <div class="container-lg">
          <span class="navbar-brand">
            <i class="bi bi-book"></i> Term Trainer
          </span>
          <div class="ms-auto" v-if="currentUser">
            <span class="text-muted small me-3">
              <i class="bi bi-person-circle"></i> {{ currentUser.username }}
            </span>
            <button class="btn btn-sm btn-outline-secondary" @click="logout">
              <i class="bi bi-box-arrow-right"></i> ë¡œê·¸ì•„ì›ƒ
            </button>
          </div>
        </div>
      </nav>

      <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
      <div class="container-lg">
        <div
          v-if="errorMessage"
          class="alert alert-danger alert-dismissible fade show"
          role="alert"
        >
          <i class="bi bi-exclamation-circle"></i> {{ errorMessage }}
          <button
            type="button"
            class="btn-close"
            @click="errorMessage = ''"
            aria-label="Close"
          ></button>
        </div>

        <div
          v-if="successMessage"
          class="alert alert-success alert-dismissible fade show"
          role="alert"
        >
          <i class="bi bi-check-circle"></i> {{ successMessage }}
          <button
            type="button"
            class="btn-close"
            @click="successMessage = ''"
            aria-label="Close"
          ></button>
        </div>

        <!-- ë¡œê·¸ì¸/íšŒì›ê°€ì… í™”ë©´ -->
        <div v-if="!currentUser" class="row mb-5">
          <!-- ë¡œê·¸ì¸ -->
          <div class="col-md-6">
            <div class="card shadow-sm">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                  <i class="bi bi-box-arrow-in-right"></i> ë¡œê·¸ì¸
                </h5>
              </div>
              <div class="card-body">
                <form @submit.prevent="login">
                  <div class="mb-3">
                    <label for="login-username" class="form-label"
                      >ì‚¬ìš©ìëª…</label
                    >
                    <input
                      id="login-username"
                      type="text"
                      class="form-control"
                      v-model="loginForm.username"
                      autocomplete="username"
                      placeholder="ì‚¬ìš©ìëª… ì…ë ¥"
                      required
                    />
                  </div>
                  <div class="mb-3">
                    <label for="login-password" class="form-label"
                      >ë¹„ë°€ë²ˆí˜¸</label
                    >
                    <input
                      id="login-password"
                      type="password"
                      class="form-control"
                      v-model="loginForm.password"
                      autocomplete="current-password"
                      placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
                      required
                    />
                  </div>
                  <button
                    type="submit"
                    class="btn btn-primary w-100"
                    :disabled="loading"
                  >
                    <span
                      v-if="loading"
                      class="spinner-border spinner-border-sm me-2"
                      role="status"
                      aria-hidden="true"
                    ></span>
                    {{ loading ? 'ë¡œê·¸ì¸ ì¤‘...' : 'ë¡œê·¸ì¸' }}
                  </button>
                </form>
              </div>
            </div>
          </div>

          <!-- íšŒì›ê°€ì… -->
          <div class="col-md-6">
            <div class="card shadow-sm">
              <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-person-plus"></i> íšŒì›ê°€ì…</h5>
              </div>
              <div class="card-body">
                <form @submit.prevent="signup">
                  <div class="mb-3">
                    <label for="signup-username" class="form-label"
                      >ì‚¬ìš©ìëª…</label
                    >
                    <input
                      id="signup-username"
                      type="text"
                      class="form-control"
                      v-model="signupForm.username"
                      autocomplete="username"
                      placeholder="ì‚¬ìš©ìëª… ì…ë ¥"
                      required
                    />
                  </div>
                  <div class="mb-3">
                    <label for="signup-password" class="form-label"
                      >ë¹„ë°€ë²ˆí˜¸</label
                    >
                    <input
                      id="signup-password"
                      type="password"
                      class="form-control"
                      v-model="signupForm.password"
                      autocomplete="new-password"
                      placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
                      required
                    />
                  </div>
                  <button
                    type="submit"
                    class="btn btn-success w-100"
                    :disabled="loading"
                  >
                    <span
                      v-if="loading"
                      class="spinner-border spinner-border-sm me-2"
                      role="status"
                      aria-hidden="true"
                    ></span>
                    {{ loading ? 'ê°€ì… ì¤‘...' : 'íšŒì›ê°€ì…' }}
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  (ë¡œê·¸ì¸ í›„) -->
        <div v-else>
          <!-- í€´ì¦ˆ ì„¹ì…˜ -->
          <section class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2><i class="bi bi-question-circle"></i> ë³µìŠµ ë¬¸ì œ</h2>
              <button
                class="btn btn-primary"
                @click="loadQuiz"
                :disabled="loading"
              >
                <i class="bi bi-arrow-clockwise"></i>
                {{ loading ? 'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...' : 'ì˜¤ëŠ˜ ë³µìŠµ ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸°' }}
              </button>
            </div>

            <!-- ëª¨ë“œ ì„ íƒ -->
            <div class="row mb-3">
              <div class="col-md-4">
                <label class="form-label">í•™ìŠµ ëª¨ë“œ</label>
                <select v-model="quiz.mode" class="form-select">
                  <option value="ko-en">í•œêµ­ì–´ â†’ ì˜ì–´</option>
                  <option value="en-ko">ì˜ì–´ â†’ í•œêµ­ì–´</option>
                </select>
              </div>
              <div class="col-md-8" v-if="quiz.totalDue !== null">
                <div class="alert alert-info mb-0">
                  <strong>
                    <i class="bi bi-info-circle"></i>
                    ì˜¤ëŠ˜ ë³µìŠµ ëŒ€ìƒ: {{ quiz.totalDue }}ê°œ
                  </strong>
                  <span class="text-muted ms-2"
                    >/ í˜„ì¬ ì„¸ì…˜: {{ quiz.questions.length }}ê°œ</span
                  >
                </div>
              </div>
            </div>

            <!-- í€´ì¦ˆ ì½˜í…ì¸  -->
            <div v-if="quiz.questions.length > 0">
              <div class="quiz-question card mb-4">
                <div class="quiz-progress text-muted small">
                  <i class="bi bi-collection"></i>
                  {{ quiz.currentIndex + 1 }} / {{ quiz.questions.length }}
                </div>
                <div class="mb-3">
                  <span v-if="quiz.mode === 'ko-en'" class="badge bg-info">
                    <i class="bi bi-translate"></i> ë²ˆì—­
                  </span>
                  <span v-else class="badge bg-info">
                    <i class="bi bi-translate"></i> ë²ˆì—­
                  </span>
                </div>
                <h4 class="text-primary">
                  <strong
                    >{{ quiz.mode === 'ko-en' ? currentQuestion?.ko :
                    currentQuestion?.en }}</strong
                  >
                </h4>
              </div>

              <!-- ë‹µ ì…ë ¥ -->
              <form @submit.prevent="submitAnswer" class="mb-4">
                <div class="mb-3">
                  <label for="answer-input" class="form-label"
                    >ë‹µì„ ì…ë ¥í•˜ì„¸ìš”</label
                  >
                  <div class="input-group">
                    <input
                      id="answer-input"
                      type="text"
                      class="form-control form-control-lg"
                      v-model="quiz.userAnswer"
                      @keyup.enter="submitAnswer"
                      placeholder="ë‹µ ì…ë ¥..."
                      :disabled="loading"
                    />
                    <button
                      type="submit"
                      class="btn btn-primary"
                      :disabled="loading || !quiz.userAnswer.trim()"
                    >
                      <i class="bi bi-check-circle"></i> ì œì¶œ
                    </button>
                  </div>
                </div>
              </form>

              <!-- ê²°ê³¼ -->
              <div v-if="quiz.result" class="mb-4">
                <div
                  v-if="quiz.result.correct"
                  class="alert alert-success"
                  role="alert"
                >
                  <i class="bi bi-check-circle-fill"></i>
                  <strong> ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰</strong>
                  <p
                    v-if="quiz.result.nextReviewAt"
                    class="mb-0 mt-2 small text-muted"
                  >
                    ë‹¤ìŒ ë³µìŠµ: {{ quiz.result.nextReviewAt }}
                  </p>
                </div>
                <div v-else class="alert alert-danger" role="alert">
                  <i class="bi bi-x-circle-fill"></i>
                  <strong> í‹€ë ¸ìŠµë‹ˆë‹¤.</strong>
                  <p class="mb-0 mt-2">
                    <strong>ì •ë‹µ:</strong> {{ quiz.result.correctAnswer }}
                  </p>
                  <p
                    v-if="quiz.result.nextReviewAt"
                    class="mb-0 small text-muted"
                  >
                    ë‹¤ìŒ ë³µìŠµ: {{ quiz.result.nextReviewAt }}
                  </p>
                </div>

                <!-- ì •ì˜ í‘œì‹œ -->
                <div
                  v-if="quiz.result.definitionKo || quiz.result.definitionEn"
                  class="card mt-3 bg-light"
                >
                  <div class="card-body">
                    <h6 class="card-subtitle mb-2">
                      <i class="bi bi-book"></i> ëœ»
                    </h6>
                    <p v-if="quiz.result.definitionKo" class="mb-2">
                      <strong>í•œêµ­ì–´:</strong> {{ quiz.result.definitionKo }}
                    </p>
                    <p v-if="quiz.result.definitionEn" class="mb-0">
                      <strong>ì˜ì–´:</strong> {{ quiz.result.definitionEn }}
                    </p>
                  </div>
                </div>

                <button
                  class="btn btn-secondary btn-sm mt-3"
                  @click="nextQuestion"
                >
                  <i class="bi bi-arrow-right"></i> ë‹¤ìŒ ë¬¸ì œ
                </button>
              </div>
            </div>
            <div v-else class="alert alert-info">
              <i class="bi bi-info-circle"></i> ì•„ì§ í€´ì¦ˆ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤. "ì˜¤ëŠ˜
              ë³µìŠµ ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸°"ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”.
            </div>
          </section>

          <!-- ìš©ì–´ ê´€ë¦¬ ì„¹ì…˜ -->
          <section class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2><i class="bi bi-list-ul"></i> ë“±ë¡ëœ ìš©ì–´</h2>
              <button
                class="btn btn-info"
                @click="loadTerms"
                :disabled="loading"
              >
                <i class="bi bi-arrow-clockwise"></i> ìƒˆë¡œê³ ì¹¨
              </button>
            </div>

            <div v-if="terms.length > 0" class="row">
              <div
                v-for="(term, index) in terms"
                :key="term?.id || index"
                class="col-md-6 mb-3"
              >
                <div v-if="term" class="card h-100 shadow-sm hover-shadow">
                  <div class="card-body">
                    <h5 class="card-title text-primary">
                      <i class="bi bi-text-left"></i> {{ term.ko }}
                    </h5>
                    <p class="card-subtitle mb-2 text-muted">{{ term.en }}</p>
                    <div v-if="term.definitionKo" class="mb-2">
                      <small class="text-muted">
                        <strong>ëœ»:</strong> {{ term.definitionKo }}
                      </small>
                    </div>
                    <div v-if="term.tags && term.tags.length > 0">
                      <span
                        v-for="tag in term.tags"
                        :key="tag"
                        class="badge bg-info bg-opacity-75 me-1"
                      >
                        #{{ tag }}
                      </span>
                    </div>

                    <!-- í•™ìŠµ ìƒíƒœ í‘œì‹œ -->
                    <div v-if="term?.stats" class="mt-3 small text-muted">
                      <div class="d-flex flex-wrap align-items-center">
                        <span class="badge bg-light text-dark me-2 mb-1">
                          LV {{ term.stats.level ?? 0 }}
                        </span>
                        <span class="me-3 mb-1">
                          âœ… {{ term.stats.correct ?? 0 }} / âŒ {{
                          term.stats.wrong ?? 0 }}
                        </span>
                        <span v-if="term.stats.nextReviewAt" class="mb-1">
                          <i class="bi bi-calendar-event"></i>
                          ë‹¤ìŒ ë³µìŠµ: {{ term.stats.nextReviewAt }}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div v-else class="alert alert-info">
              <i class="bi bi-info-circle"></i> ë“±ë¡ëœ ìš©ì–´ê°€ ì—†ìŠµë‹ˆë‹¤. ì•„ë˜ì—ì„œ
              ìƒˆë¡œ ì¶”ê°€í•´ë³´ì„¸ìš”.
            </div>
            <div class="card-body">
              <!-- ë³´ê¸° ëª¨ë“œ -->
              <div v-if="editingTermId !== term?.id">
                <h5 class="card-title text-primary">
                  <i class="bi bi-text-left"></i> {{ term?.ko }}
                </h5>
                <p class="card-subtitle mb-2 text-muted">{{ term?.en }}</p>
                <div v-if="term?.definitionKo" class="mb-2">
                  <small class="text-muted">
                    <strong>ëœ»:</strong> {{ term.definitionKo }}
                  </small>
                </div>
                <div v-if="term?.tags && term.tags.length > 0">
                  <span
                    v-for="tag in term.tags"
                    :key="tag"
                    class="badge bg-info bg-opacity-75 me-1"
                  >
                    #{{ tag }}
                  </span>
                </div>

                <!-- í•™ìŠµ ìƒíƒœ í‘œì‹œ -->
                <div v-if="term?.stats" class="mt-3 small text-muted">
                  <div class="d-flex flex-wrap align-items-center">
                    <span class="badge bg-light text-dark me-2 mb-1">
                      LV {{ term.stats.level ?? 0 }}
                    </span>
                    <span class="me-3 mb-1">
                      âœ… {{ term.stats.correct ?? 0 }} / âŒ {{ term.stats.wrong
                      ?? 0 }}
                    </span>
                    <span v-if="term.stats.nextReviewAt" class="mb-1">
                      <i class="bi bi-calendar-event"></i>
                      ë‹¤ìŒ ë³µìŠµ: {{ term.stats.nextReviewAt }}
                    </span>
                  </div>
                </div>

                <!-- ë²„íŠ¼ -->
                <div class="mt-3 d-flex justify-content-end gap-2">
                  <button
                    class="btn btn-sm btn-outline-secondary"
                    @click="startEdit(term)"
                  >
                    <i class="bi bi-pencil"></i> ìˆ˜ì •
                  </button>
                  <button
                    class="btn btn-sm btn-outline-danger"
                    @click="deleteTerm(term)"
                  >
                    <i class="bi bi-trash"></i> ì‚­ì œ
                  </button>
                </div>
              </div>

              <!-- í¸ì§‘ ëª¨ë“œ -->
              <div v-else>
                <div class="mb-2">
                  <label class="form-label">í•œêµ­ì–´ ìš©ì–´</label>
                  <input
                    type="text"
                    class="form-control"
                    v-model="editTermForm.ko"
                  />
                </div>
                <div class="mb-2">
                  <label class="form-label">ì˜ì–´ ìš©ì–´</label>
                  <input
                    type="text"
                    class="form-control"
                    v-model="editTermForm.en"
                  />
                </div>
                <div class="mb-2">
                  <label class="form-label">í•œêµ­ì–´ ì •ì˜</label>
                  <textarea
                    class="form-control"
                    rows="2"
                    v-model="editTermForm.definitionKo"
                  ></textarea>
                </div>
                <div class="mb-2">
                  <label class="form-label">ì˜ì–´ ì •ì˜</label>
                  <textarea
                    class="form-control"
                    rows="2"
                    v-model="editTermForm.definitionEn"
                  ></textarea>
                </div>
                <div class="mb-2">
                  <label class="form-label">íƒœê·¸ (ì‰¼í‘œ êµ¬ë¶„)</label>
                  <input
                    type="text"
                    class="form-control"
                    v-model="editTermForm.tagsText"
                  />
                </div>
                <div class="mt-3 d-flex justify-content-end gap-2">
                  <button class="btn btn-sm btn-secondary" @click="cancelEdit">
                    ì·¨ì†Œ
                  </button>
                  <button
                    class="btn btn-sm btn-primary"
                    @click="saveEdit(term)"
                    :disabled="loading"
                  >
                    <i class="bi bi-check-lg"></i> ì €ì¥
                  </button>
                </div>
              </div>
            </div>
          </section>

          <!-- ìš©ì–´ ì¶”ê°€ ì„¹ì…˜ -->
          <section class="mb-5">
            <h2><i class="bi bi-plus-circle"></i> ìƒˆ ìš©ì–´ ì¶”ê°€</h2>
            <div class="card">
              <form @submit.prevent="addTerm" class="card-body">
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="term-ko" class="form-label"
                      >í•œêµ­ì–´ ìš©ì–´ *</label
                    >
                    <input
                      id="term-ko"
                      type="text"
                      class="form-control"
                      v-model="newTerm.ko"
                      placeholder="ì˜ˆ: êµ¬ë…"
                      required
                    />
                  </div>
                  <div class="col-md-6">
                    <label for="term-en" class="form-label">ì˜ì–´ ìš©ì–´ *</label>
                    <input
                      id="term-en"
                      type="text"
                      class="form-control"
                      v-model="newTerm.en"
                      placeholder="ì˜ˆ: subscription"
                      required
                    />
                  </div>
                </div>
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="def-ko" class="form-label">í•œêµ­ì–´ ì •ì˜</label>
                    <textarea
                      id="def-ko"
                      class="form-control"
                      rows="2"
                      v-model="newTerm.definitionKo"
                      placeholder="í•œêµ­ì–´ ëœ» ì„¤ëª…"
                    ></textarea>
                  </div>
                  <div class="col-md-6">
                    <label for="def-en" class="form-label">ì˜ì–´ ì •ì˜</label>
                    <textarea
                      id="def-en"
                      class="form-control"
                      rows="2"
                      v-model="newTerm.definitionEn"
                      placeholder="English meaning"
                    ></textarea>
                  </div>
                </div>
                <div class="mb-3">
                  <label for="tags" class="form-label"
                    >íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label
                  >
                  <input
                    id="tags"
                    type="text"
                    class="form-control"
                    v-model="newTerm.tagsText"
                    placeholder="payment, subscription, finance"
                  />
                  <small class="text-muted"
                    >ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì—¬ëŸ¬ íƒœê·¸ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</small
                  >
                </div>
                <button
                  type="submit"
                  class="btn btn-success w-100"
                  :disabled="loading || !newTerm.ko || !newTerm.en"
                >
                  <i class="bi bi-plus-circle"></i>
                  {{ loading ? 'ì¶”ê°€ ì¤‘...' : 'ìš©ì–´ ì¶”ê°€í•˜ê¸°' }}
                </button>
              </form>
            </div>
          </section>
        </div>
      </div>
    </div>

    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- App JS -->
    <script src="./app.js"></script>
  </body>
</html>
